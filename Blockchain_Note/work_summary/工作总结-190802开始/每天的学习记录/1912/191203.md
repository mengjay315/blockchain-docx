## 191203

Cosmos-SDK联盟链权限管理

如果你在你本地的电脑上，你只能起一个节点，你可以在其他电脑上加入你启动的那个链，然后再创建验证者，



```bash
zchaincli tx staking create-validator \
  --amount=100000000zcoin \
  --pubkey=$(zchaind tendermint show-validator) \
  --moniker="zchain-test01" \
  --chain-id=zchain-test \
  --commission-rate="0.10" \
  --commission-max-rate="0.20" \
  --commission-max-change-rate="0.01" \
  --min-self-delegation="1" \
  --gas="auto" \
  --gas-prices="0.30uzcoin" \
  --from=zchain03
```

```GO
func querySupply(ctx sdk.Context, path []string, req abci.RequestQuery, k Keeper) ([]byte, sdk.Error) {
	var params types.QueryCollectionParams

	err := types.ModuleCdc.UnmarshalJSON(req.Data, &params)
	if err != nil {
		return nil, sdk.ErrUnknownRequest(sdk.AppendMsgToErr("incorrectly formatted request data", err.Error()))
	}

	collection, found := k.GetCollection(ctx, params.Denom)
	if !found {
		return nil, types.ErrUnknownCollection(types.DefaultCodespace, fmt.Sprintf("unknown denom %s", params.Denom))
	}
	
	fmt.Println("querySupply-collection:>>>>>>>>>>>>>>>>>>>>>>>>>", collection.String())
	fmt.Println("collection.Supply:+++++++++++++++++++++", collection.Supply()) // 1

	bz := make([]byte, 8)
	binary.LittleEndian.PutUint64(bz, uint64(collection.Supply()))
	fmt.Println("querySupply-result-bz:>>>>>>>>>>>>>>>>>>>>>>>>>>", bz)
	// querySupply-result-bz:>>>>>>>>>>>>>>>>>>>>>>>>>> [1 0 0 0 0 0 0 0]
	return bz, nil
}

```

```GO
func queryCollection(ctx sdk.Context, path []string, req abci.RequestQuery, k Keeper) ([]byte, sdk.Error) {
   var params types.QueryCollectionParams

   err := types.ModuleCdc.UnmarshalJSON(req.Data, &params)
   if err != nil {
      return nil, sdk.ErrUnknownRequest(sdk.AppendMsgToErr("incorrectly formatted request data", err.Error()))
   }

   collection, found := k.GetCollection(ctx, params.Denom)
   if !found {
      return nil, types.ErrUnknownCollection(types.DefaultCodespace, fmt.Sprintf("unknown denom %s", params.Denom))
   }

   // use Collections custom JSON to make the denom the key of the object
   //collections := types.NewCollections(collection)

   fmt.Println("queryCollection-collection:++++++++++++++++++++++++++++@@@", collection.String())

   bz, err := types.ModuleCdc.MarshalJSON(collection)
   if err != nil {
      return nil, sdk.ErrInternal(sdk.AppendMsgToErr("failed to JSON marshal result: %s", err.Error()))
   }

   fmt.Println("queryCollection-MarshalJSON-bz:>>>>>>>>>>>>>>>>>>>>>>>>>>>>", string(bz))

   return bz, nil
}
```

