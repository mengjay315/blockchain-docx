# 深入比特币原理（九）——Merkle树
Merkle树是一种**哈希二叉树**，它是一种用作快速归纳和校验大规模数据完整性的数据结构，比特币的交易信息存储为Merkle树结构。  
  

**比特币Merkle树结构示例：**

每一个叶子节点代表一个交易的Hash值，如**H<sub>A</sub> = SHA256(SHA256(Transaction A))**  
两个叶子节点合并后进行Hash计算，形成父节点，如**H<sub>AB</sub> = SHA256(SHA256(H<sub>A</sub> \+ H<sub>B</sub>))**

**![1q.png](_v_images/20190130193146721_1873726490.png "1519885272951188.png")**

Merkle树是一种平衡二叉树，如果交易数量为**奇数**，最后的叶子节点会被复制，组成**偶数**的叶子节点，如下：

**![2q.png](_v_images/20190130193146519_977040685.png "1519885292927562.png")**

从Merkle树的结构可以看出，任意一个叶子节点的交易被修改，叶子节点Hash值就会变更，最终Merkle Root的Hash值就会改变。所以确定的Merkle Root可以准确的作为一组交易的唯一摘要。  
  
下面我们来看一下如何通过Merkle树验证一笔交易  
假设我们要验证区块中存在Hash值为**H<sub>K</sub>**的交易，我们仅需要知道**H<sub>L</sub>、H<sub>IJ</sub>、H<sub>MNOP</sub>、H<sub>ABCDEFGH</sub>（蓝色框）**即可计算出**H<sub>KL</sub>、H<sub>IJKL</sub>、H<sub>IJKLMNOP</sub>与Root节点哈希（虚线框）**，如果最终计算得到的**Root节点哈希**与区块头中记录的哈希一致，即代表该交易在区块中存在。

**![3q.png](_v_images/20190130193146217_842119608.png "1519885318406056.png")**

使用Merkle路径验证交易，可以大大降低验证交易时需要传输的数据量，这种验证方式在SPV节点上被应用，SPV节点在需要验证交易时会向全节点请求Merkle路径信息，这是为什么**SPV节点只需要存储区块头即可验证交易的原因**

随着区块中的交易增多，区块大小将线性增长，而Merkle路径的大小增长却极其缓慢，如下表所示：

**![4q.png](_v_images/20190130193146015_2006860492.png "1519885340902966.png")**

从上表可以看到，区块内交易数从**16笔**增加到**65535笔**时，区块大小从**4KB**增加到**16MB**，但是梅克尔路径大小仅从**128bytes**增加到**512bytes**。