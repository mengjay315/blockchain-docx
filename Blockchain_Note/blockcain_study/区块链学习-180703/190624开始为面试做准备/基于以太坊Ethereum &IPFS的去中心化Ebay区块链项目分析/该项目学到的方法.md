# 该项目学到的方法

1. 该项目使用truffle框架 webpack搭建的，
2. 前端是如何和合约交互的？

- 当合约编译，部署完成后，在网页端上传图片，描述信息和填写拍卖的基本信息，填写完成后，点击提交，会触发js的代码，在app.js中，使用了web3js与合约交互，
- 点击提交会触发js代码中`saveProduct(reader, decodedParams);`保存产品，参数是读取上传图片的数据和页面填入的数据。

![](_v_images/20190626223150267_923726763.png)

**接下来分三步：**

- **保存图片到IPFS,获取hash值**

![](_v_images/20190626223301676_1386863777.png)

- **保存描述信息的大文本数据到IPFS,获取hash值**

![](_v_images/20190626223441316_1697525189.png)

- **保存产品信息到区块链**

![](_v_images/20190626223938924_1467113385.png)


3. 数据是保存到区块链上的，那么页面上如何显示呢？

**靠renderStore()方法把数据渲染到页面上**

![](_v_images/20190626224152084_1919079692.png)

![](_v_images/20190626224437379_1953991211.png)

首先还是获取合约实例，然后调用合约中的方法获取添加到区块链中产品数量，然后一个for循环，再调用合约中`getProduct`方法，根据产品id获取产品，然后把产品ID中的数据逐个读取出来，渲染到前端页面。**关于图片是要从IPFS根据hash来读取**。

![](_v_images/20190626225531489_1800464532.png)

**改进：**每次页面显示都要从区块链和IPFS上取数据，比较麻烦，做了一下改进：搭建了Nodejs服务器，使用MongoDB数据库做缓存，在添加商品时，除了把数据把保存到区块链上，同时把数据保存在数据库中，那么每次页面展示以及进入商品的详情页时，通过后端服务器，从数据库的缓存中检索数据，渲染到页面上。

**具体实现：**在合约中新增一个事件，当调用添加产品到存储时，会触发合约中的事件，前端的server.js文件有事件监听的方法，会一直监听这个事件，当监听到这个事件时，获取监听的结果，然后把数据插入到MongoDB数据库中。

**页面显示：**在app.js中改进向前端页面显示的方法，原来是从区块链中读取数据，然后渲染到页面上，这里改为从数据库中查询，把查询到的结果渲染到页面上。

