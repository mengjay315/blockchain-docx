# 深入比特币原理（三）——交易的输入(input)与输出(output)
比特币的交易模型为UTXO(unspend transaction output)，即只记录未花费的比特币输出，每次交易花费的是之前的某一个或多个输出。

![1e.png](_v_images/20190129171716426_1566437884.png "1519354797492034.png")

**什么是UTXO？**

以下借用一下网上的图

我们在现实世界中的支付系统是基于账户模型的，也就是说每一个人都有一个账户，支付就是在不同的账户中加加减减，类似如下：

![2e.png](_v_images/20190129171716324_707771042.png "1519354819234016.png")

UTXO的实现，图示如下：

![3e.png](_v_images/20190129171716221_375248450.png "1519354840720473.png")

从上面的图中可以看出，比特币存储的实际是一笔又一笔的交易，最后永远只有未花费过的交易输出，也就是UTXO。

这种设计是由中本聪原创，相对于传统的账户模型，具有以下好处：

1.账户数据库会不断膨胀，因为账户不会被删除，而UTXO数据库体积会小很多。

2.由于只有未花费的输出会被保留，所以每一个比特币用户可以拥有几乎无限多的地址，提高了匿名性。

3.UTXO为高并发的交易带来可能，试想传统的账户模型，每个人的账户交易必须是线性的，无法并发。而现在每个人可能拥有多个UTXO，可同时发起多笔交易，实现了并发。

另外有一种特殊的交易，称为Coinbase交易，即矿工挖出的比特币，该交易没有输入，只有输出（Coinbase交易我们将在挖矿章节讨论），本节内容均以非coinbase交易举例。

**比特币交易解码后的内容**

从解码的内容可以看到，比特币的交易是由输入与输出组成的，而不是账户地址。

{    
      "version": 1,    
      "locktime": 0,    
      #交易输入(input)部分
      "vin": \[           
        {    
          #输入引用的交易(transaction)HASH
          "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",       
          
          #引用交易中的UTXO索引（第一个为0，此处代表上述txid交易中的第一个UTXO）
          "vout": 0,                                    
          
          #解锁脚本，用于解锁UTXO的脚本（这是可以花费这笔UTXO的关键信息）
          "scriptSig": "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813
          \[ALL\] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",          
          "sequence": 4294967295            
        }    
      \],    
      #交易输出(output)部分 
      "vout": \[         
        {    
          #第一个输出的比特币数量
          "value": 0.01500000,             
          #锁定脚本，后续的交易如要使用该输出，必须解锁锁定脚本
          "scriptPubKey": "OP\_DUP OP\_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP\_EQUALVERIFY OP\_CHECKSIG"          
        },    
        {    
          #第二个输出的比特币数量
          "value": 0.08450000,             
          "scriptPubKey": "OP\_DUP OP\_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP\_EQUALVERIFY OP\_CHECKSIG",    
        }    
      \]    
    }

可以从以上内容看出，比特币的交易中实际没有账户余额信息，只有输入(input)与输出(output)两部分信息。

说的更直白一点，比特币的交易类似于现实世界中直接用支票进行交易。如A写给B一张100元的支票，其中A是输入，B是输出。当B需要给C付50元时，B不是去银行兑现支票然后付款给C，而是直接写两张新支票，一张50元给C，一张50元给自己，再将原来100元的支票作废，即完成一次非基于账户模型的支付。

**最后附上交易输入输出的内容格式：**

**输入**

![5w.png](_v_images/20190129171716116_1497331616.png "1519355057613495.png")

**输出**

![55w.png](_v_images/20190129171715914_205407449.png "1519355108225471.png")

交易费

比特币每次交易需要支付交易费给矿工，比特币早期交易费基本为0，但随着交易增多，交易费逐步开始升高。交易费是除产生新比特币外对矿工的另一种激励，在全部比特币被挖出后，矿工的收入将全部来自于交易费。交易费的特点如下：  
1.交易费是一种激励，同时也是一种安全机制，使经济上不利于攻击者通过大量交易来淹没网络。  
2.交易费是通过字节大小来计算，而不是花费比特币的多少。  
3.目前交易均使用动态交易费，交易费的高低会影响交易被矿工处理（加入区块链）的优先级，交易费过低或为0的交易极少会被处理，甚至不会在网络上广播。  
4.交易费不会存储在交易信息中，而是通过输出(output)与输入(input)的差值来替代（如果你要自己创建交易必须千万注意输出的金额大小，因为交易的差值无论大小全部会被矿工获得）  
   交易费 = SUM（所有输入） - SUM（所有输出）  
5.预估当前合适的交易费  
访问第三方网站：[https://bitcoinfees.earn.com](https://bitcoinfees.earn.com/)

![image.png](_v_images/20190129171715813_654591450.png "1524448370983596.png")

通过该网站页面可预估当前合适的交易费用，如图中所示当前（2018/2/27）快速确认的手续费为50 satoshis/byte（一般交易大小为226 bytes）  
  
可通过调用该网站提供的HTTP REST API计算不同优先级下的交易费  
$ curl https://bitcoinfees.21.co/api/v1/fees/recommended  
{"fastestFee":50,"halfHourFee":40,"hourFee":20}  
fastestFee：最快确认  
halfHourFee：三个块内确认  
hourFee：六个块内确认